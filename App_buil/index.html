<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>å­¦ä¸­æ–‡ - Há»c Tá»« Vá»±ng Tiáº¿ng Trung</title>
    <meta name="description"
        content="á»¨ng dá»¥ng há»c tá»« vá»±ng tiáº¿ng Trung vá»›i phÃ¡t Ã¢m, flashcard, quiz vÃ  há»‡ thá»‘ng Ã´n táº­p thÃ´ng minh">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=2.0">
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <span class="logo-icon">æ±‰</span>
                <h1>å­¦ä¸­æ–‡</h1>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-value" id="totalWords">0</span>
                    <span class="stat-label">Tá»« vá»±ng</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="learnedWords">0</span>
                    <span class="stat-label">ÄÃ£ thuá»™c</span>
                </div>
                <div class="stat-item review-stat" onclick="navigateTo('review')">
                    <span class="stat-value" id="dueToday">0</span>
                    <span class="stat-label">Cáº§n Ã´n</span>
                    <span class="review-badge-header" id="reviewBadge" style="display: none;"></span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Home Screen -->
            <section class="screen active" id="homeScreen">
                <div class="welcome-card">
                    <h2>ChÃ o má»«ng báº¡n! ðŸŽ‰</h2>
                    <p>Báº¯t Ä‘áº§u hÃ nh trÃ¬nh há»c tiáº¿ng Trung cá»§a báº¡n</p>
                </div>

                <!-- Review Alert -->
                <div class="review-alert" id="reviewAlert" style="display: none;">
                    <div class="alert-content">
                        <span class="alert-icon">ðŸ””</span>
                        <div class="alert-text">
                            <strong id="alertCount">0</strong> tá»« cáº§n Ã´n táº­p hÃ´m nay
                        </div>
                    </div>
                    <button class="btn btn-sm" onclick="navigateTo('review')">Ã”n ngay</button>
                </div>

                <div class="action-grid">
                    <button class="action-card" onclick="navigateTo('groups')">
                        <div class="action-icon">ðŸ“</div>
                        <h3>NhÃ³m tá»«</h3>
                        <p>Quáº£n lÃ½ theo chá»§ Ä‘á»</p>
                    </button>
                    <button class="action-card" onclick="navigateTo('vocabulary')">
                        <div class="action-icon">ðŸ“š</div>
                        <h3>Tá»« Vá»±ng</h3>
                        <p>Danh sÃ¡ch tá»«</p>
                    </button>
                    <button class="action-card has-badge" onclick="navigateTo('review')">
                        <div class="action-icon">ðŸ”„</div>
                        <h3>Ã”n táº­p</h3>
                        <p>SRS thÃ´ng minh</p>
                        <span class="card-badge" id="reviewCardBadge"></span>
                    </button>
                    <button class="action-card" onclick="navigateTo('flashcard')">
                        <div class="action-icon">ðŸŽ´</div>
                        <h3>Flashcard</h3>
                        <p>Há»c tháº» ghi nhá»›</p>
                    </button>
                    <button class="action-card" onclick="navigateTo('quiz')">
                        <div class="action-icon">â“</div>
                        <h3>Quiz</h3>
                        <p>Kiá»ƒm tra trÃ­ nhá»›</p>
                    </button>
                    <button class="action-card" onclick="navigateTo('analytics')">
                        <div class="action-icon">ðŸ“Š</div>
                        <h3>Thá»‘ng kÃª</h3>
                        <p>PhÃ¢n tÃ­ch tiáº¿n Ä‘á»™</p>
                    </button>
                    <button class="action-card" onclick="navigateTo('import')">
                        <div class="action-icon">ðŸ“¥</div>
                        <h3>Import</h3>
                        <p>Nháº­p tá»« Excel</p>
                    </button>
                    <button class="action-card" onclick="navigateTo('matching')">
                        <div class="action-icon">ðŸŽ®</div>
                        <h3>GhÃ©p tháº»</h3>
                        <p>TrÃ² chÆ¡i ghÃ©p cáº·p</p>
                    </button>
                    <button class="action-card" onclick="navigateTo('backup')">
                        <div class="action-icon">ðŸ’¾</div>
                        <h3>Sao lÆ°u</h3>
                        <p>Xuáº¥t/Nháº­p dá»¯ liá»‡u</p>
                    </button>
                </div>

                <div class="recent-section">
                    <h3>ðŸ“Š Tiáº¿n Ä‘á»™ há»c táº­p</h3>
                    <div class="progress-overview">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <span class="progress-text" id="progressText">0%</span>
                    </div>
                </div>

                <!-- Review Calendar Preview -->
                <div class="calendar-section">
                    <h3>ðŸ“… Lá»‹ch Ã´n táº­p tuáº§n nÃ y</h3>
                    <div class="calendar-preview" id="homeCalendar"></div>
                </div>
            </section>

            <!-- Groups Screen -->
            <section class="screen" id="groupsScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸ“ NhÃ³m tá»« vá»±ng</h2>
                </div>

                <div class="groups-controls">
                    <button class="btn btn-primary" onclick="openAddGroupModal()">+ Táº¡o nhÃ³m má»›i</button>
                </div>

                <div class="groups-list" id="groupsList">
                    <!-- Groups will be rendered here -->
                </div>
            </section>

            <!-- Vocabulary Screen -->
            <section class="screen" id="vocabularyScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸ“š Danh sÃ¡ch tá»« vá»±ng</h2>
                </div>

                <!-- Group Filter -->
                <div class="group-filter-container" id="groupFilterContainer">
                    <!-- Group filters will be rendered here -->
                </div>

                <div class="vocab-controls">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="TÃ¬m kiáº¿m tá»« vá»±ng..."
                            oninput="searchVocabulary()">
                    </div>
                    <button class="btn btn-secondary" onclick="toggleSelectMode()" id="selectModeBtn">â˜‘ï¸ Chá»n</button>
                    <button class="btn btn-primary" onclick="openAddModal()">+ ThÃªm tá»«</button>
                </div>

                <!-- Bulk Actions Toolbar (hidden by default) -->
                <div class="bulk-toolbar" id="bulkToolbar" style="display: none;">
                    <label class="select-all-label">
                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                        <span>Chá»n táº¥t cáº£</span>
                    </label>
                    <span class="selected-count">ÄÃ£ chá»n: <strong id="selectedCount">0</strong></span>
                    <button class="btn btn-danger btn-sm" onclick="deleteSelected()" id="deleteSelectedBtn" disabled>ðŸ—‘ï¸
                        XÃ³a Ä‘Ã£ chá»n</button>
                    <button class="btn btn-secondary btn-sm" onclick="cancelSelectMode()">Há»§y</button>
                </div>

                <div class="vocab-list" id="vocabList">
                    <!-- Vocabulary items will be rendered here -->
                </div>
            </section>

            <!-- Review Screen (SRS) -->
            <section class="screen" id="reviewScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸ”„ Ã”n táº­p hÃ´m nay</h2>
                </div>

                <!-- Group selector for review -->
                <div class="review-group-selector">
                    <label>Chá»n nhÃ³m:</label>
                    <select id="reviewGroupSelect" onchange="initReviewSession(this.value)">
                        <option value="all">Táº¥t cáº£</option>
                        <!-- Groups will be populated -->
                    </select>
                </div>

                <div class="review-container" id="reviewContainer">
                    <div class="review-progress">
                        <span id="reviewCurrent">0</span> / <span id="reviewTotal">0</span>
                    </div>

                    <div class="review-card" id="reviewCard" onclick="flipReviewCard()">
                        <div class="review-card-inner">
                            <div class="review-card-front">
                                <span class="chinese-char" id="reviewChinese">ä½ å¥½</span>
                                <button class="speak-btn"
                                    onclick="event.stopPropagation(); speakChinese(document.getElementById('reviewChinese').textContent)">ðŸ”Š</button>
                            </div>
                            <div class="review-card-back">
                                <span class="pinyin" id="reviewPinyin">nÇ hÇŽo</span>
                                <span class="meaning" id="reviewMeaning">Xin chÃ o</span>
                                <span class="example" id="reviewExample"></span>
                            </div>
                        </div>
                    </div>

                    <p class="review-hint">Click tháº» Ä‘á»ƒ xem Ä‘Ã¡p Ã¡n</p>

                    <div class="review-actions" id="reviewActions" style="display: none;">
                        <button class="btn btn-danger" onclick="answerReview(false)">âŒ ChÆ°a nhá»›</button>
                        <button class="btn btn-success" onclick="answerReview(true)">âœ… ÄÃ£ nhá»›</button>
                    </div>
                </div>

                <div class="review-complete" id="reviewComplete" style="display: none;">
                    <div class="complete-card">
                        <span class="complete-icon">ðŸŽ‰</span>
                        <h3>HoÃ n thÃ nh!</h3>
                        <p>Báº¡n Ä‘Ã£ Ã´n táº­p <strong id="reviewedCount">0</strong> tá»«</p>
                        <button class="btn btn-primary" onclick="navigateTo('home')">Vá» trang chá»§</button>
                    </div>
                </div>

                <div class="empty-state" id="reviewEmpty" style="display: none;">
                    <p>âœ¨ KhÃ´ng cÃ³ tá»« nÃ o cáº§n Ã´n hÃ´m nay!</p>
                    <p class="empty-sub">HÃ£y quay láº¡i sau hoáº·c há»c thÃªm tá»« má»›i</p>
                    <button class="btn btn-primary" onclick="navigateTo('vocabulary')">ThÃªm tá»« vá»±ng</button>
                </div>
            </section>

            <!-- Flashcard Screen -->
            <section class="screen" id="flashcardScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸŽ´ Flashcard</h2>
                </div>

                <!-- Group selector for flashcard -->
                <div class="flashcard-group-selector">
                    <label>Chá»n nhÃ³m:</label>
                    <select id="flashcardGroupSelect" onchange="initFlashcardWithGroup(this.value)">
                        <option value="all">Táº¥t cáº£</option>
                    </select>
                </div>

                <div class="flashcard-container">
                    <div class="flashcard-progress">
                        <span id="flashcardCurrent">0</span> / <span id="flashcardTotal">0</span>
                    </div>

                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <span class="chinese-char" id="flashcardChinese">ä½ å¥½</span>
                                <button class="speak-btn"
                                    onclick="event.stopPropagation(); speakChinese(document.getElementById('flashcardChinese').textContent)">ðŸ”Š</button>
                            </div>
                            <div class="flashcard-back">
                                <span class="pinyin" id="flashcardPinyin">nÇ hÇŽo</span>
                                <span class="meaning" id="flashcardMeaning">Xin chÃ o</span>
                                <span class="example" id="flashcardExample"></span>
                            </div>
                        </div>
                    </div>

                    <div class="flashcard-actions">
                        <button class="btn btn-danger" onclick="markWord(false)">âŒ ChÆ°a thuá»™c</button>
                        <button class="btn btn-success" onclick="markWord(true)">âœ… ÄÃ£ thuá»™c</button>
                    </div>

                    <div class="flashcard-nav">
                        <button class="btn btn-secondary" onclick="prevCard()">â† TrÆ°á»›c</button>
                        <button class="btn btn-secondary" id="toggleWritingBtn" onclick="toggleWritingMode()">âœï¸ Luyá»‡n
                            viáº¿t</button>
                        <button class="btn btn-secondary" onclick="nextCard()">Sau â†’</button>
                    </div>
                </div>

                <!-- Writing Practice Container -->
                <div class="writing-container" id="writingContainer" style="display: none;">
                    <div class="flashcard-progress">
                        <span id="writingCurrent">0</span> / <span id="writingTotal">0</span>
                    </div>

                    <div class="writing-hint">
                        <span class="pinyin" id="writingPinyin">nÇ hÇŽo</span>
                        <span class="meaning" id="writingMeaning">Xin chÃ o</span>
                    </div>

                    <div class="canvas-wrapper">
                        <canvas id="writingCanvas"></canvas>
                        <div class="character-overlay" id="characterOverlay">
                            <span class="overlay-character" id="overlayCharacter">ä½ å¥½</span>
                        </div>
                    </div>

                    <div class="writing-controls">
                        <button class="btn btn-sm btn-secondary" onclick="clearWritingCanvas()">ðŸ—‘ï¸ XÃ³a</button>
                        <button class="btn btn-sm btn-secondary" onclick="undoLastStroke()">â†©ï¸ HoÃ n tÃ¡c</button>
                        <button class="btn btn-sm btn-primary" onclick="showCharacterOverlay()">ðŸ‘ï¸ Xem Ä‘Ã¡p Ã¡n</button>
                    </div>

                    <div class="writing-nav">
                        <button class="btn btn-secondary" onclick="prevWritingCard()">â† TrÆ°á»›c</button>
                        <button class="btn btn-secondary" onclick="toggleWritingMode()">ðŸŽ´ Xem tháº»</button>
                        <button class="btn btn-secondary" onclick="nextWritingCard()">Sau â†’</button>
                    </div>
                </div>

                <div class="empty-state" id="flashcardEmpty" style="display: none;">
                    <p>ðŸ“­ ChÆ°a cÃ³ tá»« vá»±ng nÃ o. HÃ£y thÃªm tá»« vá»±ng trÆ°á»›c!</p>
                    <button class="btn btn-primary" onclick="navigateTo('vocabulary')">ThÃªm tá»« vá»±ng</button>
                </div>
            </section>

            <!-- Quiz Screen -->
            <section class="screen" id="quizScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>â“ Quiz</h2>
                </div>

                <div class="quiz-setup" id="quizSetup">
                    <!-- Group selector for quiz -->
                    <div class="quiz-group-selector">
                        <label>Chá»n nhÃ³m:</label>
                        <select id="quizGroupSelect">
                            <option value="all">Táº¥t cáº£</option>
                        </select>
                    </div>

                    <!-- Question count selector -->
                    <div class="quiz-count-selector">
                        <label>Sá»‘ cÃ¢u há»i: <strong id="questionCountDisplay">10</strong></label>
                        <input type="range" id="questionCountSlider" min="3" max="50" value="10"
                            oninput="document.getElementById('questionCountDisplay').textContent = this.value">
                        <div class="range-labels">
                            <span>3</span>
                            <span>50</span>
                        </div>
                    </div>

                    <h3>Chá»n cháº¿ Ä‘á»™ Quiz</h3>
                    <div class="quiz-modes">
                        <button class="quiz-mode-btn" onclick="startQuizWithGroup('meaning')">
                            <span class="mode-icon">ðŸ“–</span>
                            <span class="mode-title">Chá»n nghÄ©a</span>
                            <span class="mode-desc">Xem chá»¯ HÃ¡n â†’ Chá»n nghÄ©a Ä‘Ãºng</span>
                        </button>
                        <button class="quiz-mode-btn" onclick="startQuizWithGroup('character')">
                            <span class="mode-icon">æ±‰</span>
                            <span class="mode-title">Chá»n chá»¯</span>
                            <span class="mode-desc">Xem nghÄ©a â†’ Chá»n chá»¯ HÃ¡n Ä‘Ãºng</span>
                        </button>
                    </div>
                </div>

                <div class="quiz-game" id="quizGame" style="display: none;">
                    <div class="quiz-header">
                        <div class="quiz-progress">
                            CÃ¢u <span id="quizCurrent">1</span> / <span id="quizTotal">10</span>
                        </div>
                        <div class="quiz-score">
                            Äiá»ƒm: <span id="quizScore">0</span>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <div class="question-content" id="questionContent">
                            <span class="question-chinese">ä½ å¥½</span>
                        </div>
                        <button class="speak-btn quiz-speak" id="quizSpeakBtn"
                            onclick="speakChinese(currentQuizWord)">ðŸ”Š</button>
                    </div>

                    <div class="quiz-options" id="quizOptions">
                        <!-- Options will be rendered here -->
                    </div>

                    <div class="quiz-actions">
                        <button class="btn btn-secondary" onclick="saveQuizProgress()">ðŸ’¾ LÆ°u tiáº¿n Ä‘á»™</button>
                        <button class="btn btn-primary" onclick="submitIncompleteQuiz()">ðŸ“ Ná»™p bÃ i</button>
                    </div>
                </div>

                <div class="quiz-result" id="quizResult" style="display: none;">
                    <div class="result-card">
                        <h3 id="resultTitle">ðŸŽ‰ HoÃ n thÃ nh!</h3>
                        <div class="result-score">
                            <span class="score-value" id="finalScore">8</span>
                            <span class="score-total" id="scoreTotalDisplay">/ 10</span>
                        </div>
                        <div class="result-stats" id="resultStats"></div>
                        <div class="result-message" id="resultMessage">Xuáº¥t sáº¯c!</div>
                        <button class="btn btn-primary" onclick="resetQuiz()">LÃ m láº¡i</button>
                    </div>
                </div>

                <div class="empty-state" id="quizEmpty" style="display: none;">
                    <p>ðŸ“­ Cáº§n Ã­t nháº¥t 4 tá»« vá»±ng Ä‘á»ƒ chÆ¡i Quiz!</p>
                    <button class="btn btn-primary" onclick="navigateTo('vocabulary')">ThÃªm tá»« vá»±ng</button>
                </div>
            </section>

            <!-- Analytics Screen -->
            <section class="screen" id="analyticsScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸ“Š Thá»‘ng kÃª há»c táº­p</h2>
                </div>

                <div class="analytics-container">
                    <!-- Overall Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-icon">ðŸ“š</span>
                            <span class="stat-number" id="statTotal">0</span>
                            <span class="stat-desc">Tá»•ng tá»« vá»±ng</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">âœ…</span>
                            <span class="stat-number" id="statLearned">0</span>
                            <span class="stat-desc">ÄÃ£ thuá»™c</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">ðŸ”„</span>
                            <span class="stat-number" id="statDueToday">0</span>
                            <span class="stat-desc">Cáº§n Ã´n</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">ðŸŽ¯</span>
                            <span class="stat-number" id="statAccuracy">0%</span>
                            <span class="stat-desc">Äá»™ chÃ­nh xÃ¡c</span>
                        </div>
                        <div class="stat-card highlight">
                            <span class="stat-icon">ðŸ”¥</span>
                            <span class="stat-number" id="statStreak">0 ngÃ y</span>
                            <span class="stat-desc">Streak</span>
                        </div>
                    </div>

                    <!-- Mastery Progress -->
                    <div class="analytics-section">
                        <h3>ðŸ† Má»©c Ä‘á»™ thÃ nh tháº¡o</h3>
                        <div class="mastery-bar-container">
                            <div class="mastery-bar" id="masteryBar"></div>
                        </div>
                        <span class="mastery-text" id="masteryText">0%</span>
                    </div>

                    <!-- Status Distribution -->
                    <div class="analytics-section">
                        <h3>ðŸ“ˆ PhÃ¢n bá»‘ tráº¡ng thÃ¡i</h3>
                        <div id="statusChart"></div>
                    </div>

                    <!-- Group Progress -->
                    <div class="analytics-section">
                        <h3>ðŸ“ Tiáº¿n Ä‘á»™ theo nhÃ³m</h3>
                        <div id="groupProgress"></div>
                    </div>

                    <!-- Weekly Activity -->
                    <div class="analytics-section">
                        <h3>ðŸ“… Hoáº¡t Ä‘á»™ng 7 ngÃ y qua</h3>
                        <div id="weeklyChart"></div>
                    </div>

                    <!-- Review Calendar -->
                    <div class="analytics-section">
                        <h3>ðŸ—“ï¸ Lá»‹ch Ã´n táº­p</h3>
                        <div class="review-calendar" id="reviewCalendar"></div>
                    </div>
                </div>
            </section>

            <!-- Import Screen -->
            <section class="screen" id="importScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸ“¥ Import tá»« Excel</h2>
                </div>

                <div class="import-container">
                    <!-- Group selector for import -->
                    <div class="import-group-selector">
                        <label>Import vÃ o nhÃ³m:</label>
                        <select id="importGroupSelect">
                            <!-- Groups will be populated -->
                        </select>
                        <button class="btn btn-sm btn-secondary" onclick="openAddGroupModal()">+ Táº¡o nhÃ³m</button>
                    </div>

                    <div class="import-info">
                        <h3>ðŸ“‹ HÆ°á»›ng dáº«n</h3>
                        <p>File Excel cáº§n cÃ³ cÃ¡c cá»™t theo thá»© tá»±:</p>
                        <table class="format-table">
                            <thead>
                                <tr>
                                    <th>Cá»™t A</th>
                                    <th>Cá»™t B</th>
                                    <th>Cá»™t C</th>
                                    <th>Cá»™t D (tÃ¹y chá»n)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Chá»¯ HÃ¡n</td>
                                    <td>Pinyin</td>
                                    <td>NghÄ©a</td>
                                    <td>VÃ­ dá»¥</td>
                                </tr>
                                <tr class="example-row">
                                    <td>ä½ å¥½</td>
                                    <td>nÇ hÇŽo</td>
                                    <td>Xin chÃ o</td>
                                    <td>ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜Ž</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="import-dropzone" id="dropzone">
                        <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="handleFileSelect(event)" hidden>
                        <div class="dropzone-content" onclick="document.getElementById('fileInput').click()">
                            <span class="dropzone-icon">ðŸ“</span>
                            <p>KÃ©o tháº£ file Excel vÃ o Ä‘Ã¢y</p>
                            <p class="dropzone-hint">hoáº·c click Ä‘á»ƒ chá»n file</p>
                        </div>
                    </div>

                    <div class="import-preview" id="importPreview" style="display: none;">
                        <h3>Xem trÆ°á»›c dá»¯ liá»‡u</h3>
                        <div class="preview-list" id="previewList"></div>
                        <div class="import-actions">
                            <button class="btn btn-secondary" onclick="cancelImport()">Há»§y</button>
                            <button class="btn btn-primary" onclick="confirmImportWithGroup()">Import <span
                                    id="importCount">0</span> tá»«</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Backup & Export Screen -->
            <section class="screen" id="backupScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸ’¾ Sao lÆ°u & KhÃ´i phá»¥c</h2>
                </div>

                <div class="backup-container">
                    <!-- Export Section -->
                    <div class="backup-section">
                        <h3>ðŸ“¤ Xuáº¥t dá»¯ liá»‡u</h3>
                        <p class="section-desc">LÆ°u trá»¯ tá»« vá»±ng vÃ  tiáº¿n Ä‘á»™ há»c táº­p cá»§a báº¡n</p>

                        <div class="export-actions">
                            <button class="btn btn-primary" onclick="exportToJSON()">
                                ðŸ“„ Xuáº¥t JSON
                            </button>
                            <button class="btn btn-secondary" onclick="exportToExcel()">
                                ðŸ“Š Xuáº¥t Excel
                            </button>
                        </div>

                        <div class="info-box">
                            <p><strong>ðŸ’¡ Gá»£i Ã½:</strong></p>
                            <ul>
                                <li>JSON: DÃ¹ng Ä‘á»ƒ sao lÆ°u Ä‘áº§y Ä‘á»§ (bao gá»“m tiáº¿n Ä‘á»™ SRS)</li>
                                <li>Excel: DÃ¹ng Ä‘á»ƒ xem vÃ  chá»‰nh sá»­a dá»¯ liá»‡u</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Import Section -->
                    <div class="backup-section">
                        <h3>ðŸ“¥ KhÃ´i phá»¥c dá»¯ liá»‡u</h3>
                        <p class="section-desc">Nháº­p láº¡i dá»¯ liá»‡u tá»« file sao lÆ°u</p>

                        <div class="import-file-selector">
                            <input type="file" id="jsonFileInput" accept=".json" onchange="importJSONFile(event)"
                                hidden>
                            <button class="btn btn-secondary"
                                onclick="document.getElementById('jsonFileInput').click()">
                                ðŸ“‚ Chá»n file JSON
                            </button>
                        </div>

                        <!-- Import Preview -->
                        <div class="import-preview-section" id="importPreviewSection" style="display: none;">
                            <div id="importDataPreview" class="data-preview"></div>

                            <div class="import-mode-select">
                                <label>
                                    <input type="radio" name="importMode" value="replace" checked>
                                    <span>Thay tháº¿ toÃ n bá»™ (xÃ³a dá»¯ liá»‡u cÅ©)</span>
                                </label>
                                <label>
                                    <input type="radio" name="importMode" value="merge">
                                    <span>Gá»™p vá»›i dá»¯ liá»‡u hiá»‡n táº¡i</span>
                                </label>
                            </div>

                            <div class="import-confirm-actions">
                                <button class="btn btn-secondary" onclick="cancelBackupImport()">Há»§y</button>
                                <button class="btn btn-primary"
                                    onclick="confirmImportData(document.querySelector('input[name=importMode]:checked').value)">
                                    âœ… XÃ¡c nháº­n nháº­p
                                </button>
                            </div>
                        </div>

                        <div class="warning-box">
                            <p><strong>âš ï¸ LÆ°u Ã½:</strong></p>
                            <p>Cháº¿ Ä‘á»™ "Thay tháº¿ toÃ n bá»™" sáº½ xÃ³a háº¿t dá»¯ liá»‡u hiá»‡n táº¡i. HÃ£y cÃ¢n nháº¯c ká»¹ trÆ°á»›c khi thá»±c
                                hiá»‡n!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Matching Game Screen -->
            <section class="screen" id="matchingScreen">
                <div class="screen-header">
                    <button class="back-btn" onclick="navigateTo('home')">â† Quay láº¡i</button>
                    <h2>ðŸŽ® GhÃ©p tháº» ghi nhá»›</h2>
                </div>

                <div class="matching-setup" id="matchingSetup">
                    <!-- Group selector for matching game -->
                    <div class="matching-group-selector">
                        <label>Chá»n nhÃ³m:</label>
                        <select id="matchingGroupSelect">
                            <option value="all">Táº¥t cáº£</option>
                        </select>
                    </div>

                    <h3>Chá»n Ä‘á»™ khÃ³</h3>
                    <div class="difficulty-modes">
                        <button class="difficulty-btn"
                            onclick="startMatchingGame('easy', document.getElementById('matchingGroupSelect').value)">
                            <span class="diff-icon">ðŸ˜Š</span>
                            <span class="diff-title">Dá»…</span>
                            <span class="diff-desc">4 cáº·p (4x2)</span>
                        </button>
                        <button class="difficulty-btn"
                            onclick="startMatchingGame('medium', document.getElementById('matchingGroupSelect').value)">
                            <span class="diff-icon">ðŸ¤”</span>
                            <span class="diff-title">Trung bÃ¬nh</span>
                            <span class="diff-desc">6 cáº·p (4x3)</span>
                        </button>
                        <button class="difficulty-btn"
                            onclick="startMatchingGame('hard', document.getElementById('matchingGroupSelect').value)">
                            <span class="diff-icon">ðŸ˜Ž</span>
                            <span class="diff-title">KhÃ³</span>
                            <span class="diff-desc">8 cáº·p (4x4)</span>
                        </button>
                    </div>
                </div>

                <div class="matching-game-container" id="matchingGame" style="display: none;">
                    <div class="matching-stats">
                        <div class="stat-box">
                            <span class="stat-label">â± Thá»i gian</span>
                            <span class="stat-value" id="matchingTime">0:00</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">ðŸŽ¯ Sá»‘ bÆ°á»›c</span>
                            <span class="stat-value" id="matchingMoves">0</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">âœ… Cáº·p Ä‘Ãºng</span>
                            <span class="stat-value" id="matchingPairs">0/0</span>
                        </div>
                    </div>

                    <div class="matching-grid" id="matchingGrid">
                        <!-- Cards will be rendered here -->
                    </div>
                </div>

                <div class="matching-result" id="matchingResult" style="display: none;">
                    <div class="result-card">
                        <h3 id="matchingResultTitle">ðŸŽ‰ HoÃ n thÃ nh!</h3>
                        <div class="result-stats-grid">
                            <div class="result-stat">
                                <span class="result-label">Thá»i gian</span>
                                <span class="result-value" id="finalTime">0:00</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-label">Sá»‘ bÆ°á»›c</span>
                                <span class="result-value" id="finalMoves">0</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-label">Cáº·p tá»«</span>
                                <span class="result-value" id="finalPairs">0</span>
                            </div>
                            <div class="result-stat highlight">
                                <span class="result-label">Äiá»ƒm sá»‘</span>
                                <span class="result-value" id="matchingTotalScore">0</span>
                            </div>
                        </div>
                        <div class="result-message" id="matchingResultMessage">Xuáº¥t sáº¯c!</div>
                        <button class="btn btn-primary" onclick="resetMatchingGame()">ChÆ¡i láº¡i</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="navigateTo('home')" data-screen="home">
                <span class="nav-icon">ðŸ </span>
                <span class="nav-label">Trang chá»§</span>
            </button>
            <button class="nav-item" onclick="navigateTo('groups')" data-screen="groups">
                <span class="nav-icon">ðŸ“</span>
                <span class="nav-label">NhÃ³m</span>
            </button>
            <button class="nav-item has-badge" onclick="navigateTo('review')" data-screen="review">
                <span class="nav-icon">ðŸ”„</span>
                <span class="nav-label">Ã”n táº­p</span>
                <span class="nav-badge" id="navReviewBadge"></span>
            </button>
            <button class="nav-item" onclick="navigateTo('analytics')" data-screen="analytics">
                <span class="nav-icon">ðŸ“Š</span>
                <span class="nav-label">Thá»‘ng kÃª</span>
            </button>
        </nav>
    </div>

    <!-- Add/Edit Vocabulary Modal -->
    <div class="modal" id="vocabModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ThÃªm tá»« vá»±ng</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="vocabForm" onsubmit="saveVocabulary(event)">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label for="inputChinese">Chá»¯ HÃ¡n *</label>
                    <input type="text" id="inputChinese" required placeholder="ä¾‹: ä½ å¥½">
                </div>
                <div class="form-group">
                    <label for="inputPinyin">Pinyin *</label>
                    <input type="text" id="inputPinyin" required placeholder="ä¾‹: nÇ hÇŽo">
                </div>
                <div class="form-group">
                    <label for="inputMeaning">NghÄ©a tiáº¿ng Viá»‡t *</label>
                    <input type="text" id="inputMeaning" required placeholder="ä¾‹: Xin chÃ o">
                </div>
                <div class="form-group">
                    <label for="inputExample">VÃ­ dá»¥ (tÃ¹y chá»n)</label>
                    <input type="text" id="inputExample" placeholder="ä¾‹: ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜Ž">
                </div>
                <div class="form-group">
                    <label for="inputGroup">NhÃ³m</label>
                    <select id="inputGroup">
                        <!-- Groups will be populated -->
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Há»§y</button>
                    <button type="submit" class="btn btn-primary">LÆ°u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Group Modal -->
    <div class="modal" id="groupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="groupModalTitle">Táº¡o nhÃ³m má»›i</h3>
                <button class="close-btn" onclick="closeGroupModal()">&times;</button>
            </div>
            <form id="groupForm" onsubmit="saveGroup(event)">
                <input type="hidden" id="editGroupId">
                <div class="form-group">
                    <label for="groupNameInput">TÃªn nhÃ³m *</label>
                    <input type="text" id="groupNameInput" required placeholder="ä¾‹: HSK 1">
                </div>
                <div class="form-group">
                    <label for="groupDescInput">MÃ´ táº£</label>
                    <input type="text" id="groupDescInput" placeholder="ä¾‹: Tá»« vá»±ng HSK cáº¥p 1">
                </div>
                <div class="form-group">
                    <label>MÃ u sáº¯c</label>
                    <input type="hidden" id="groupColorInput" value="#6366f1">
                    <div class="color-picker" id="colorPicker"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeGroupModal()">Há»§y</button>
                    <button type="submit" class="btn btn-primary">LÆ°u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Scripts (order matters for dependencies) -->
    <script src="js/vocabulary.js"></script>
    <script src="js/groups.js"></script>
    <script src="js/srs.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/speech.js"></script>
    <script src="js/flashcard.js"></script>
    <script src="js/writing-practice.js"></script>
    <script src="js/matching-game.js?v=2.0"></script>
    <script src="js/quiz.js"></script>
    <script src="js/excel-import.js"></script>
    <script src="js/backup.js?v=2.0"></script>
    <script src="js/app.js"></script>
</body>

</html>